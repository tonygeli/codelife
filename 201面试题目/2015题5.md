[toc]

## 主从复制

三个线程：Master一条线程和Slave中的两条线程

- master（binlog dump thread)
- Slave (I/O thread  SQL thread)

1.主节点binlog，主从复制的基础是主库记录数据库的所有变更记录到binlog。
2.主节点log dump线程，当binlog有变动时，log dump线程读取其内容并发送给从节点。
3.从节点I/O线程接收binlog内容，并将其写入relay log文件中。
4.从节点的SQL线程读取relay log文件内容对数据更新进行重放，最终保证主从数据库的一致性。

注：主从节点使用binlog文件+position偏移量来定位主从同步的位置，从节点会保存其已接收到的偏移量，如果从节点重启，则自动从position的位置发起同步。

### 全同步复制

主库写入binlog后强制同步日志到从库，所有的从库都执行完成后才返回客户端，性能有影响。

### 半同步复制

和半同步不同的是，半同步复制的逻辑，从库写入日志成功后返回ACK确认给主库，主库收到至少一个从库的确认就认为写操作成功



## 索引类型和对性能的影响

普通索引

唯一索引

主键：一种特殊的唯一索引

联合索引：覆盖多个数据列，INDEX(colA, colB);

全文索引：通过建立`倒排索引`， Alter Table t_name Add Fulltext(column)

## RDB和AOF机制

RDB： redis database

将内存中的数据集快照写入磁盘，实际操作过程是fork一个子进程，将数据集写入临时文件，写入成功后，替换之前的文件，用二进制压缩存储。

优点：

1.整个Redis数据库只包含一个文件dump.rdb，方便持久化
2.容灾性好，方便备份
3.性能最大化，fork子进程来完成写操作，主进程继续处理命令，所以IO最大化。
4.对于数据集大时，比AOF的启动效率更高。

缺点：

1.数据安全性低。RDB是间隔一段时间进行持久化，2次持久化之间发生故障数据丢失
2.数据大时，可能导致服务停止

AOF：Append Only File



