# 2.6.2消息队列协议

[TOC]



## 什么是协议？

消息中间件负责数据的传递，存储和分发消费三个部分，数据的存储和分发的过程中肯定要遵循某种约定的规范，采取底层的TCP/IP,UDP协议还是其他的自己构建的协议。

1.计算机操作系统和应用程序通讯时共同遵循一组约定，只有遵循相同的约定和规范，系统和系统之间才能相互交流。
2.和一般的网络应用程序的不同它主要负责数据的接收和传递，所以性能比较高。
3.协议对数据格式和计算机之间交换数据都必须严格遵守规范。

## 网络协议的三要素

1.语法。用户数据与控制信息的结构与格式，以及数据出现的顺序。http规定了报文和响应报文的格式。
2.语义。解释控制信息每个部分的意义。post/get请求。
3.时序。对时间发生顺序的详细说明。 一个请求对应一个响应。

**消息中间件采用的不是http协议，常见的消息中间件协议：OpenWire，AMQP，MQTT，Kafka**

### 面试题：为什么消息中间不直接使用http协议呢？

1.因为http请求报文头和响应报文头比较复杂，包含cookie，数据加密解密，状态码，响应码等附加的功能，但是对于一个消息而言，我们并不需要这么复杂，它只负责数据传递、存储、分发，追求的高性能。
2.大部分http都是短连接，在实际的交互过程中，一个请求到响应很有可能会中断，中断以后就不会进行持久化，容易造成请求的丢失。目的是为了保证消息和数据的高可靠和稳健的运行。

## AMQP协议

AMQP：Advanced Message Queuing Protocol高级消息队列协议。摩根大通集团联合设计。是提供统一消息服务的应用层标准高级消息队列协议，是应用层协议的一个开放标准，为面向消息的中间件设计。基于此协议的客户端和消息中间件可传递消息，并不受客户端、中间件不同产品，不同的开发语言等条件的限制。
Erlang中的实现由RabbitMQ等。
特性：
	1.分布式事务支持
	2.消息的持久化支持
	3.高性能和高可靠的消息处理优势

## MQTT协议

MQTT：Message Queuing Telemetry Transport 消息队列是IBM开放的一个及时通讯协议，物联网系统架构中的重要组成部分。
特点：
	1.轻量
	2.结构简单
	3.传输快，不支持事务
	4.没有持久化设计
应用场景：
	1.适用于计算能力有限
	2.低带宽
	3.网络不稳定的场景
支持：RabbitMQ ActiveMQ

## OpenMessage协议

最近由阿里、雅虎和滴滴出行共同参与与创立的分布式消息中间件、流处理等领域的应用开发标准。
特点：
	1.结构简单
	2.解析速度快
	3.支持事务和持久化设计

## Kafka协议

Kafka协议是基于TCP/IP的二进制协议，消息内部是通过长度来分割，由一些基本数据类型组成。
特点：
	1.结构简单
	2.解析速度快
	3.无事务支持
	4.有持久化设计

